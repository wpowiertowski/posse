services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: posse 
    volumes:
      - .:/app
      - ./config.yml:/app/config.yml:ro
    secrets:
      - pushover_app_token
      - pushover_user_key
      # Example secrets for multi-account Mastodon
      # Uncomment and add corresponding secret files as needed
      # - mastodon_personal_access_token
      # - mastodon_work_access_token
      # Example secrets for multi-account Bluesky
      # - bluesky_main_access_token
      # - bluesky_professional_access_token
    command: poetry run posse
    stdin_open: true
    tty: true

  test:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: posse-test
    volumes:
      - .:/app
      - ./config.yml:/app/config.yml:ro
    command: poetry run pytest
    profiles:
      - test

# Docker secrets for credentials
# Secrets naming convention: {platform}_{account_name}_{credential_type}
# Examples:
#   - mastodon_personal_access_token
#   - mastodon_work_access_token
#   - bluesky_main_access_token
#
# To use secrets:
# 1. Create secrets directory and secret files with your credentials:
#    mkdir -p secrets
#    printf '%s' 'YOUR_ACTUAL_APP_TOKEN_HERE' > secrets/pushover_app_token.txt
#    printf '%s' 'YOUR_ACTUAL_USER_KEY_HERE' > secrets/pushover_user_key.txt
#    printf '%s' 'YOUR_MASTODON_TOKEN' > secrets/mastodon_personal_access_token.txt
# 2. Configure accounts in config.yml with appropriate secret paths
secrets:
  pushover_app_token:
    file: ./secrets/pushover_app_token.txt
  pushover_user_key:
    file: ./secrets/pushover_user_key.txt
  # Example multi-account secrets - add as needed
  # mastodon_personal_access_token:
  #   file: ./secrets/mastodon_personal_access_token.txt
  # mastodon_work_access_token:
  #   file: ./secrets/mastodon_work_access_token.txt
  # bluesky_main_access_token:
  #   file: ./secrets/bluesky_main_access_token.txt
  # bluesky_professional_access_token:
  #   file: ./secrets/bluesky_professional_access_token.txt
