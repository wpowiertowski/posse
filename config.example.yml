# POSSE Multi-Account Configuration Example
# This is a comprehensive example showing multi-account setup for Mastodon and Bluesky

# Timezone for generated timestamps (IANA name, e.g. UTC or America/Los_Angeles)
# Default: UTC
timezone: "UTC"

# CORS Configuration (Optional)
# Enable cross-origin requests for the API endpoints (needed for browser-based widgets)
cors:
  enabled: true  # Enable CORS support
  origins:
    - "https://yourblog.com"  # Your Ghost blog URL
    - "https://www.yourblog.com"  # With www prefix if used

# Ghost Content API (Optional)
# Required for automatic syndication mapping discovery and enhanced interaction sync
ghost:
  content_api:
    url: "https://yourblog.com"  # Your Ghost blog URL
    key_file: "/run/secrets/ghost_content_api_key"  # Ghost Content API key
    # key: "your-content-api-key"  # Alternative: inline key (not recommended)
    version: "v5.0"  # Ghost API version
    timeout: 30  # Request timeout in seconds

# LLM Vision Service (Optional)
# Configure a vision-capable LLM service (like Llama 3.2 Vision) to automatically
# generate alt text for images that don't already have alt text in Ghost posts
llm:
  enabled: false  # Set to true to enable automatic alt text generation
  url: "llama-vision"  # Hostname or URL of the LLM service (without http://)
  port: 5000  # Port number for the LLM service
  # timeout: 60  # Optional: Request timeout in seconds (default: 60)

# Pushover Push Notifications
# Optional: Get notified when posts are received and queued
pushover:
  enabled: true
  app_token_file: /run/secrets/pushover_app_token
  user_key_file: /run/secrets/pushover_user_key

# Mastodon Multi-Account Configuration
# Configure multiple Mastodon accounts
mastodon:
  accounts:
    # Personal account - receives all posts (no tags filter)
    - name: "personal"
      instance_url: "https://mastodon.social"
      access_token_file: "/run/secrets/mastodon_personal_access_token"
      # tags: []  # Empty or omitted means this account receives ALL posts
      # max_post_length: 500  # Optional: Override default character limit (default: 500 for Mastodon)
      # split_multi_image_posts: false  # Optional: Split posts with multiple images into separate posts, one image each (default: false)
    
    # Professional/Tech account - only receives tech-related posts
    - name: "tech"
      instance_url: "https://fosstodon.org"
      access_token_file: "/run/secrets/mastodon_tech_access_token"
      tags: ["technology", "programming", "python"]  # Only posts with these tags
      max_post_length: 450  # Custom character limit for this account
    
    # Work account - filtered by work-related tags
    - name: "work"
      instance_url: "https://mastodon.company.com"
      access_token_file: "/run/secrets/mastodon_work_access_token"
      tags: ["work", "business", "enterprise"]
    
    # Archive account - receives ALL posts (no tags filter)
    - name: "archive"
      instance_url: "https://mastodon.archive.org"
      access_token_file: "/run/secrets/mastodon_archive_access_token"
      tags: []  # Empty list means this account receives ALL posts
      split_multi_image_posts: true  # Split multi-image posts into separate posts

# Bluesky Multi-Account Configuration
# Same structure as Mastodon - configure multiple accounts
bluesky:
  accounts:
    # Main Bluesky account - receives all posts
    - name: "main"
      instance_url: "https://bsky.social"
      handle: "user.bsky.social"  # Your Bluesky handle
      app_password_file: "/run/secrets/bluesky_main_app_password"
      # No tags field means this account receives ALL posts
      # max_post_length: 300  # Optional: Override default character limit (default: 300 for Bluesky)
    
    # Professional Bluesky account - only technical posts
    - name: "professional"
      instance_url: "https://bsky.social"
      handle: "professional.bsky.social"  # Your Bluesky handle
      app_password_file: "/run/secrets/bluesky_professional_app_password"
      tags: ["tech", "coding"]  # Only posts tagged with these
      max_post_length: 280  # Custom character limit for this account
      # split_multi_image_posts: false  # Optional: Split posts with multiple images into separate posts, one image each (default: false)

# Webmention Sending
# Send webmentions to one or more targets when posts match a tag.
# Each target specifies a tag that triggers sending, an endpoint URL,
# and a target URL. Useful for submitting to aggregators or notifying sites.
webmention:
  enabled: true
  targets:
    - name: "IndieWeb News"                                # Human-readable label
      endpoint: "https://news.indieweb.org/en/webmention"  # Webmention endpoint URL
      target: "https://news.indieweb.org/en"               # Target URL for the webmention
      tag: "indiewebnews"                                  # Tag slug that triggers submission
      timeout: 30                                          # Request timeout in seconds
    # Add more targets as needed:
    # - name: "Another Aggregator"
    #   endpoint: "https://example.com/webmention"
    #   target: "https://example.com"
    #   tag: "syndicate"
    #   timeout: 30

# Social Interaction Sync Configuration
# Sync interactions (likes, reposts, comments) from social media back to Ghost
interactions:
  enabled: true  # Enable/disable interaction syncing (default: true)
  sync_interval_minutes: 30  # How often to check for new interactions (default: 30)
  max_post_age_days: 30  # Maximum age of posts to sync (default: 30)
  cache_directory: "./data/interactions"  # Where to store interaction data

  # Privacy settings (optional)
  show_reply_content: true  # Show full comment text (default: true)
  show_reply_authors: true  # Show commenter names and avatars (default: true)

# =============================================================================
# Security Configuration
# =============================================================================
# Configure security settings for the API endpoints
security:
  # Referrer validation for interactions endpoint
  # Only allow requests from these domains (leave empty to disable validation)
  # Supports exact matches and wildcard subdomains (e.g., "*.yourblog.com")
  allowed_referrers:
    - "https://yourblog.com"
    - "https://www.yourblog.com"
    # - "*.yourblog.com"  # Wildcard for all subdomains

  # IP-based rate limiting
  rate_limit_enabled: true  # Enable/disable rate limiting (default: true)
  rate_limit_requests: 60  # Max requests per IP per window (default: 60)
  rate_limit_window_seconds: 60  # Rate limit window in seconds (default: 60)

  # Discovery rate limiting (prevents enumeration attacks)
  # Limits expensive discovery operations that query external APIs
  discovery_rate_limit_enabled: true  # Enable/disable (default: true)
  discovery_rate_limit: 50  # Max discovery attempts per window (default: 50)
  discovery_rate_window_seconds: 60  # Window in seconds (default: 60)

  # Internal API token for protected endpoints (like /sync)
  # If set, these endpoints require X-Internal-Token header
  # Can also be set via INTERNAL_API_TOKEN environment variable
  # internal_api_token: "your-secret-token"  # Uncomment and set a strong token
  internal_api_token_file: "/run/secrets/internal_api_token"  # Alternative: use Docker secret

# =============================================================================
# Webmention Reply Form
# =============================================================================
# Serve a reply form at GET /webmention and accept replies at POST /api/webmention/reply.
# Replies are stored as h-entry pages and sent as webmentions to the target post.
webmention_reply:
  enabled: false
  blog_name: "My Blog"
  allowed_target_origins:
    - "https://yourblog.com"
  # Cloudflare Turnstile CAPTCHA (optional)
  # turnstile_site_key: "your-site-key"
  # turnstile_secret_key_file: "/run/secrets/turnstile_secret"
  rate_limit: 5                    # Max replies per IP per window
  rate_limit_window_seconds: 3600  # Window in seconds (1 hour)

# =============================================================================
# Webmention Receiver (W3C)
# =============================================================================
# Accept incoming webmentions from external sites at POST /webmention.
# Verified webmentions are queryable at GET /api/webmentions?target=<url>.
webmention_receiver:
  enabled: false
  allowed_target_origins:
    - "https://yourblog.com"
  rate_limit: 10                  # Max incoming webmentions per IP per window
  rate_limit_window_seconds: 60   # Window in seconds
